# Railway Deployment Guide

This guide explains how to deploy your Laravel Barista Coffee App to Railway using Docker.

## Prerequisites

1. A [Railway](https://railway.app/) account
2. Git repository with your code pushed to GitHub/GitLab/Bitbucket

## Deployment Steps

### 1. Push Your Code to Git

Make sure all your code, including the Docker files, is committed and pushed to your Git repository:

```bash
git add .
git commit -m "Add Docker configuration for Railway deployment"
git push origin main
```

### 2. Create a New Project on Railway

1. Go to [Railway](https://railway.app/)
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your repository
5. Railway will automatically detect the Dockerfile and start building

### 3. Configure Environment Variables

In the Railway dashboard, add the following environment variables:

**Required:**
- `APP_NAME` = "Barista Coffee App"
- `APP_ENV` = "production"
- `APP_KEY` = (will be auto-generated by the entrypoint script)
- `APP_DEBUG` = "false"
- `APP_URL` = (Railway will provide this, or use your custom domain)

**Database (SQLite is default, but you can use Railway's PostgreSQL/MySQL):**
- `DB_CONNECTION` = "sqlite" (or "mysql"/"pgsql")

**For MySQL/PostgreSQL (if using Railway database):**
- `DB_HOST` = (provided by Railway)
- `DB_PORT` = (provided by Railway)
- `DB_DATABASE` = (provided by Railway)
- `DB_USERNAME` = (provided by Railway)
- `DB_PASSWORD` = (provided by Railway)

**Session & Cache:**
- `SESSION_DRIVER` = "database"
- `CACHE_STORE` = "database"
- `QUEUE_CONNECTION` = "database"

**Optional:**
- `LOG_CHANNEL` = "stack"
- `LOG_LEVEL` = "error"

### 4. Add a Database (Optional)

If you want to use PostgreSQL or MySQL instead of SQLite:

1. In your Railway project, click "New"
2. Select "Database" â†’ "PostgreSQL" or "MySQL"
3. Railway will automatically create environment variables
4. Update your `DB_CONNECTION` environment variable accordingly

### 5. Deploy

Railway will automatically deploy your application. You can monitor the build logs in the dashboard.

### 6. Access Your Application

Once deployed, Railway will provide you with a URL like:
```
https://your-app-name.up.railway.app
```

## Docker Configuration Overview

### Files Created

- **Dockerfile**: Multi-stage build configuration for Laravel
- **.dockerignore**: Excludes unnecessary files from the Docker image
- **docker/docker-entrypoint.sh**: Initialization script that runs migrations and setup
- **docker/nginx.conf**: Nginx web server configuration
- **docker/default.conf**: Laravel-specific Nginx site configuration
- **docker/supervisord.conf**: Process manager configuration for PHP-FPM, Nginx, and Queue workers
- **railway.toml**: Railway-specific deployment configuration

### What Happens During Build

1. Installs PHP 8.2 with required extensions
2. Installs Composer and Node.js
3. Installs PHP dependencies (production only)
4. Installs Node dependencies
5. Builds frontend assets with Vite
6. Configures Nginx and Supervisor
7. Sets up proper permissions

### What Happens During Startup

1. Creates `.env` file if missing
2. Generates `APP_KEY` if not set
3. Creates SQLite database file
4. Runs database migrations
5. Caches configuration, routes, and views
6. Starts PHP-FPM, Nginx, and Queue workers

## Troubleshooting

### Build Fails

- Check the Railway build logs for specific errors
- Ensure all dependencies in `composer.json` and `package.json` are correct
- Verify that the Dockerfile syntax is correct

### Application Not Starting

- Check the deployment logs in Railway dashboard
- Verify environment variables are set correctly
- Ensure `APP_KEY` is generated (check logs for "Generating application key...")

### Database Errors

- If using external database, verify connection credentials
- Check that migrations ran successfully in the logs
- For SQLite, ensure the database file has proper permissions

### 502 Bad Gateway

- Check if PHP-FPM is running (view logs)
- Verify Nginx configuration is correct
- Ensure port 8080 is properly exposed

## Custom Domain

To use a custom domain:

1. Go to your Railway project settings
2. Click "Domains"
3. Add your custom domain
4. Update DNS records as instructed by Railway
5. Update `APP_URL` environment variable to your custom domain

## Scaling

Railway automatically handles scaling. For better performance:

- Consider upgrading your Railway plan
- Use Redis for cache and sessions (add Redis service in Railway)
- Optimize your Laravel application (caching, query optimization)

## Local Testing

To test the Docker setup locally:

```bash
# Build the image
docker build -t barista-coffee-app .

# Run the container
docker run -p 8080:8080 barista-coffee-app

# Access at http://localhost:8080
```

## Support

For Railway-specific issues, check:
- [Railway Documentation](https://docs.railway.app/)
- [Railway Discord](https://discord.gg/railway)

For Laravel issues:
- [Laravel Documentation](https://laravel.com/docs)

# Railway Deployment Guide

This guide explains how to deploy your Laravel Barista Coffee App to Railway.

## Prerequisites

1. A [Railway](https://railway.app/) account
2. Git repository with your code pushed to GitHub/GitLab/Bitbucket

## Deployment Steps

### 1. Push Your Code to Git

Make sure all your code is committed and pushed to your Git repository:

```bash
git add .
git commit -m "Update for Railway deployment"
git push origin main
```

### 2. Create a New Project on Railway

1. Go to [Railway](https://railway.app/)
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your repository
5. Railway will detect your PHP application and set it up

### 3. Configure Environment Variables

In the Railway dashboard, add the following environment variables:

**Required:**
- `APP_NAME` = "Barista Coffee App"
- `APP_ENV` = "production"
- `APP_KEY` = (will be auto-generated by the entrypoint script)
- `APP_DEBUG` = "false"
- `APP_URL` = (Railway will provide this, or use your custom domain)

**Database (SQLite is default, but you can use Railway's PostgreSQL/MySQL):**
- `DB_CONNECTION` = "sqlite" (or "mysql"/"pgsql")

**For MySQL/PostgreSQL (if using Railway database):**
- `DB_HOST` = (provided by Railway)
- `DB_PORT` = (provided by Railway)
- `DB_DATABASE` = (provided by Railway)
- `DB_USERNAME` = (provided by Railway)
- `DB_PASSWORD` = (provided by Railway)

**Session & Cache:**
- `SESSION_DRIVER` = "database"
- `CACHE_STORE` = "database"
- `QUEUE_CONNECTION` = "database"

**Optional:**
- `LOG_CHANNEL` = "stack"
- `LOG_LEVEL` = "error"

### 4. Add a Database (Optional)

If you want to use PostgreSQL or MySQL instead of SQLite:

1. In your Railway project, click "New"
2. Select "Database" â†’ "PostgreSQL" or "MySQL"
3. Railway will automatically create environment variables
4. Update your `DB_CONNECTION` environment variable accordingly

### 5. Deploy

Railway will automatically deploy your application. You can monitor the build logs in the dashboard.

### 6. Access Your Application

Once deployed, Railway will provide you with a URL like:
```
https://your-app-name.up.railway.app
```

## Deployment Configuration

### What Happens During Deployment

1. Installs PHP 8.2 with required extensions
2. Installs Composer and Node.js
3. Installs PHP dependencies (production only)
4. Installs Node dependencies
5. Builds frontend assets with Vite
6. Configures Nginx and Supervisor
7. Sets up proper permissions

### What Happens During Startup

1. Creates `.env` file if missing
2. Generates `APP_KEY` if not set
3. Creates SQLite database file
4. Runs database migrations
5. Caches configuration, routes, and views
6. Starts PHP-FPM, Nginx, and Queue workers

## Troubleshooting

### Common Issues

#### Build Failures

- Check the Railway build logs for specific errors
- Ensure all dependencies in `composer.json` and `package.json` are correct

### Application Not Starting

- Check the deployment logs in Railway dashboard
- Verify environment variables are set correctly

### Database Errors

- If using external database, verify connection credentials
- Check that migrations ran successfully in the logs
- For SQLite, ensure the database file has proper permissions

### 502 Bad Gateway

- Check if PHP-FPM is running (view logs)
- Verify Nginx configuration is correct
- Ensure port 8080 is properly exposed

## Custom Domain

To use a custom domain:

1. Go to your Railway project settings
2. Click "Domains"
3. Add your custom domain
4. Update DNS records as instructed by Railway
5. Update `APP_URL` environment variable to your custom domain

## Scaling

Railway automatically handles scaling. For better performance:

- Consider upgrading your Railway plan
- Use Redis for cache and sessions (add Redis service in Railway)
- Optimize your Laravel application (caching, query optimization)

## Local Testing

To test the application locally, follow the standard Laravel development setup:

1. Install PHP and Composer
2. Run `composer install`
3. Set up your `.env` file
4. Run `php artisan serve`
5. Access at http://localhost:8000

## Support

For Railway-specific issues, check:
- [Railway Documentation](https://docs.railway.app/)
- [Railway Discord](https://discord.gg/railway)

For Laravel issues:
- [Laravel Documentation](https://laravel.com/docs)
